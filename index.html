<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Synthesis - A/V Experience</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Hydra Synth -->
    <script src="https://unpkg.com/hydra-synth/dist/hydra-synth.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&family=Pixelify+Sans&family=Courier+Prime:wght@700&family=Bangers&family=Orbitron:wght@900&family=Playfair+Display:ital,wght@1,900&family=Monoton&family=Press+Start+2P&family=Permanent+Marker&family=Righteous&family=Bebas+Neue&display=swap" rel="stylesheet">

    <style>
        :root {
            --sat: env(safe-area-inset-top);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: black;
            color: white;
            /* Abilita scroll verticale per il percorso */
            overflow-x: hidden;
            overflow-y: auto; 
            touch-action: pan-y;
            margin: 0;
            padding: 0;
        }
        
        /* Navbar Sticky/Fixed con padding per notch */
        nav {
            padding-top: max(1rem, var(--sat)) !important;
            padding-left: max(1.5rem, env(safe-area-inset-left)) !important;
            padding-right: max(1.5rem, env(safe-area-inset-right)) !important;
        }

        .view-transition {
            transition: all 0.7s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .fade-out-scale {
            opacity: 0;
            transform: scale(1.1);
            filter: blur(4px);
            pointer-events: none;
        }
        
        .fade-in-up {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
        
        .hidden-down {
            opacity: 0;
            transform: translateY(2rem);
            pointer-events: none;
        }

        /* SVG Percorso */
        #route-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        .path-line {
            fill: none;
            stroke: rgba(255, 255, 255, 0.2); 
            stroke-width: 2;
            stroke-dasharray: 0; /* Linea continua */
        }

        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
    </style>
</head>
<body class="selection:bg-white selection:text-black">

    <!-- Sfondo Nero -->
    <div class="fixed inset-0 w-full h-full bg-black -z-20"></div>

    <!-- APP CONTAINER -->
    <div id="app" class="relative w-full min-h-screen">

        <!-- === HOME VIEW (ROUTE) === -->
        <div id="home-view" class="relative w-full min-h-screen pb-20 view-transition opacity-100 scale-100 blur-0">
            
            <!-- Navbar: Fixed + Sfondo Nero sfumato per visibilitÃ  su scroll -->
            <nav class="fixed top-0 w-full px-6 md:px-12 flex justify-between items-center z-50 bg-black/80 backdrop-blur-md pb-4 border-b border-white/10">
                <!-- PULSANTE EXIT: Rimosso border -->
                <button onclick="handleExit()" class="pointer-events-auto text-xs font-black tracking-[0.2em] text-red-600 hover:text-red-400 transition-colors uppercase font-mono py-2 bg-black/50 px-4 rounded">
                    [ EXIT ]
                </button>
                <button onclick="toggleHelp()" class="pointer-events-auto flex items-center justify-center w-8 h-8 rounded-full border-2 border-white text-white hover:bg-white hover:text-black transition-all font-bold text-sm shadow-[0_0_10px_rgba(255,255,255,0.2)] bg-black">
                    ?
                </button>
            </nav>

            <!-- Header Content -->
            <div class="pt-32 pb-12 text-center relative z-20 px-4">
                <h1 id="synthesis-title" class="text-5xl md:text-8xl font-bold tracking-tighter mb-4 text-white uppercase transition-all duration-75 drop-shadow-xl">
                    Synthesis
                </h1>
                <p class="text-[10px] md:text-xs font-sans tracking-wide uppercase opacity-90 text-gray-300 mb-2">
                    Si consiglia prima d'iniziare l'esperienza di cliccare il "?" in alto a destra.
                </p>
                <p class="text-[10px] md:text-xs font-sans tracking-[0.3em] uppercase opacity-60 animate-pulse text-gray-400">
                    Clicca le immagini
                </p>
            </div>

            <!-- ROUTE CONTAINER (PERCORSO 1-8) -->
            <div class="relative w-full max-w-4xl mx-auto px-4 md:px-0">
                <svg id="route-svg"><path class="path-line" d="" /></svg>
                <div id="route-items" class="relative z-10 flex flex-col gap-16 md:gap-32 py-10"></div>
            </div>
            
            <!-- Footer -->
            <div class="text-center py-20 opacity-30 text-[25px] uppercase tracking-widest">
                YOU ARE ONE
            </div>
        </div>

        <!-- === HELP MODAL === -->
        <div id="help-modal" class="fixed inset-0 z-[60] bg-black/95 backdrop-blur-md flex items-center justify-center hidden opacity-0 transition-opacity duration-300 p-4">
            <div class="bg-black text-white p-6 md:p-8 max-w-md w-full relative shadow-[0_0_30px_rgba(255,255,255,0.1)] transform transition-transform scale-100 border-2 border-white rounded-lg">
                <button onclick="toggleHelp()" class="absolute top-2 right-4 text-white hover:text-gray-400 font-bold text-2xl p-2">&times;</button>
                <h2 class="text-xl md:text-2xl font-bold mb-6 uppercase tracking-wider border-b border-white/30 pb-2">Guida</h2>
                <ul class="space-y-4 font-sans text-xs md:text-sm leading-relaxed text-gray-200">
                    <li class="flex items-start"><span class="mr-3 font-bold text-white">1.</span> <span>Segui il percorso e clicca sulle immagini.</span></li>
                    <li class="flex items-start"><span class="mr-3 font-bold text-white">2.</span> <span>Le icone indicano la funzionalitÃ  (mouse, microfono, webcam, swipe).</span></li>
                    <li class="flex items-start"><span class="mr-3 font-bold text-white">3.</span> <span><span class="font-bold text-white">Attenzione:</span> Attiva la suoneria e usa le cuffie ðŸŽ§</span></li>
                    <li class="flex items-start"><span class="mr-3 font-bold text-white">3.</span> <span><span class="font-bold text-white">Attenzione:</span>Le icone ti dicono gli elementi culminanti degli effetti.</span></li>
                </ul>
            </div>
        </div>

        <!-- === EXIT VIEW === -->
        <div id="exit-view" class="fixed inset-0 z-[100] bg-black flex flex-col items-center justify-center hidden">
            <h1 class="text-2xl md:text-5xl font-mono font-bold tracking-widest text-red-600 uppercase animate-pulse text-center px-4 leading-relaxed drop-shadow-[0_0_10px_rgba(255,0,0,0.8)]">
                YOU CAN'T ESCAPE<br>FROM YOURSELF
            </h1>
        </div>

        <!-- === DETAIL VIEW === -->
        <div id="detail-view" class="fixed inset-0 z-50 bg-white flex flex-col view-transition hidden-down">
            <div class="absolute top-0 left-0 w-full p-6 md:p-8 z-50 pointer-events-none">
                <button onclick="goBack()" id="back-btn" class="pointer-events-auto group flex items-center space-x-2 text-xs md:text-sm font-sans uppercase tracking-widest transition-colors cursor-pointer bg-black/20 backdrop-blur-sm p-3 rounded-full text-white hover:bg-black/40 shadow-lg">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transform group-hover:-translate-x-1 transition-transform">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                    <span>Torna al Percorso</span>
                </button>
            </div>
            <div class="flex-1 w-full h-full relative bg-black flex items-center justify-center overflow-hidden">
                <canvas id="hydra-canvas" class="absolute inset-0 w-full h-full object-cover hidden"></canvas>
                <iframe id="external-iframe" class="absolute inset-0 w-full h-full border-0 hidden bg-white"></iframe>
                <div id="standard-content" class="text-center space-y-6 max-w-2xl px-4 bg-white/90 p-8 rounded-xl hidden">
                    <p class="text-gray-500 font-sans leading-relaxed">Caricamento...</p>
                </div>
                <div id="av-overlay" class="absolute inset-0 z-20 flex flex-col items-center justify-center bg-black/40 backdrop-blur-sm hidden text-center">
                    <button id="start-btn" class="flex items-center gap-3 px-8 py-4 bg-white text-black font-bold uppercase tracking-widest hover:bg-gray-200 transition-transform transform hover:scale-105 rounded-full cursor-pointer shadow-xl">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="black" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                        <span id="start-btn-text">AVVIA ESPERIENZA</span>
                    </button>
                    <p id="start-btn-subtext" class="mt-6 text-white text-[10px] md:text-xs font-sans tracking-widest uppercase opacity-80 max-w-md px-4 drop-shadow-md"></p>
                    <h2 id="av-slogan" class="hidden absolute bottom-16 md:bottom-20 text-white text-2xl md:text-4xl tracking-[0.2em] w-full px-4 drop-shadow-lg" style="font-family: 'Bebas Neue', sans-serif;">
                        AMPLIFY YOUR POSITIVE AND NEGATIVE SENSATIONS
                    </h2>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- ROUTE DATA (Sequenza 1-8 Corretta) ---
        const routeData = [
            // 1. Synthesis 1 (Ex Synthesis 2)
            { 
                id: 2, 
                title: "Synthesis 2", 
                image: "https://github.com/NgaLegins/Synthesis3/blob/main/Screenshot%202026-01-20%20alle%2023.26.23.png?raw=true",
                link: "https://ngalegins.github.io/Synthesis3/",
                hasWebcam: true, 
                iconColor: 'text-black' 
            },
            { 
                id: 6, 
                title: "Synthesis 6", 
                image: "https://github.com/NgaLegins/Gif-Photos/blob/main/Substance%20GIF%20(1).gif?raw=true",
                link: "https://ngalegins.github.io/Synthesis7/",
                hasSwipe: true, 
                iconColor: 'text-white' 
            },
            { 
                id: 1, 
                title: "Synthesis 1", 
                image: "https://github.com/NgaLegins/Synthesis2/blob/main/Screenshot%202026-01-21%20alle%2000.42.54.png?raw=true",
                link: "https://ngalegins.github.io/Synthesis2/",
                hasAudio: true,
                iconColor: 'text-white' 
            },
            { 
                id: 3, 
                title: "Synthesis 3", 
                image: "https://github.com/NgaLegins/Synthesis4/blob/main/Screenshot%202026-01-20%20alle%2017.16.08.png?raw=true", 
                link: "https://ngalegins.github.io/Synthesis4/", 
                hasMic: true, 
                iconColor: 'text-black' 
            },
            { 
                id: 'special-av', 
                title: "Synthesis 4", 
                image: "https://raw.githubusercontent.com/NgaLegins/Synthesis/main/Screenshot%202026-01-20%20alle%2015.40.25.png",
                link: "https://ngalegins.github.io/Synthesis5/",
                isSpecial: true,
            },
            // 7. Synthesis 7 (Ex Synthesis 8)
            { 
                id: 5, 
                title: "Synthesis 5", 
                image: "https://github.com/NgaLegins/Gif-Photos/blob/main/Screenshot%202026-01-20%20alle%2022.39.03.png?raw=true",
                link: "https://ngalegins.github.io/Synthesis6/",
                hasEye: true,
                iconColor: 'text-white'
            },
            {
                id: 7, 
                title: "Synthesis 7",
                image: "https://github.com/NgaLegins/Gif-Photos/blob/main/tumblr_9810ea184dcb78bcb12116e6c7e45ff0_b8e0b2f5_640.gif?raw=true",
                link: "https://ngalegins.github.io/Synthesis8/",
                hasAudio: true, 
                iconColor: 'text-white'
            },
            // 8. Synthesis 8 (Ex Synthesis 10 GIF)
            {
                id: 8, 
                title: "Synthesis 8",
                image: "https://github.com/NgaLegins/Synthesis10/blob/main/Daily%20Flicks.gif?raw=true",
                link: "https://ngalegins.github.io/Synthesis10/",
                hasEye: true, 
                iconColor: 'text-black'
            }
        ];

        let currentItem = null;
        let audioCtx = null;
        let scriptsLoaded = false;

        window.onload = () => {
            renderRoute();
            startTitleGlitch(); 
            window.addEventListener('resize', drawPath);
        };

        function renderRoute() {
            const container = document.getElementById('route-items');
            let html = '';

            routeData.forEach((item, index) => {
                const itemData = encodeURIComponent(JSON.stringify(item));
                
                // Tutti centrati
                const alignClass = 'items-center';
                const borderClass = 'border-2 border-transparent hover:border-white/50';
                
                let iconHtml = getIconHtml(item);

                html += `
                    <div class="route-item w-full flex flex-col ${alignClass} relative px-8" data-index="${index}">
                        
                        <!-- REMOVED NUMBER BACKGROUND -->

                        <div onclick="handleItemClick('${itemData}')" 
                             class="card-element relative z-10 w-full md:w-96 aspect-[4/3] bg-white cursor-pointer transform transition-all duration-300 hover:scale-105 hover:z-20 shadow-2xl ${borderClass}">
                             
                            <div class="w-full h-full overflow-hidden relative">
                                <img src="${item.image}" alt="${item.title}" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-500" />
                                <div class="absolute inset-0 bg-black/10 hover:bg-transparent transition-colors"></div>
                                <div class="absolute top-2 right-2 ${item.iconColor || 'text-white'} animate-pulse drop-shadow-md">
                                    ${iconHtml}
                                </div>
                            </div>
                        </div>
                        
                        <!-- REMOVED TITLE LABEL -->
                    </div>
                `;
            });

            container.innerHTML = html;
            setTimeout(drawPath, 100);
        }

        function drawPath() {
            const svg = document.getElementById('route-svg');
            const items = document.querySelectorAll('.card-element');
            const pathElement = svg.querySelector('path');
            
            if (items.length === 0) return;

            const containerHeight = document.getElementById('route-items').offsetHeight;
            svg.setAttribute('height', containerHeight + 200);

            let d = "";
            
            items.forEach((item, i) => {
                const rect = item.getBoundingClientRect();
                const containerRect = document.getElementById('route-items').getBoundingClientRect();
                
                const x = rect.left + rect.width / 2 - containerRect.left;
                const y = rect.top + rect.height / 2 - containerRect.top;

                if (i === 0) {
                    d += `M ${x} ${y}`;
                } else {
                    d += ` L ${x} ${y}`;
                }
            });
            pathElement.setAttribute('d', d);
        }

        function getIconHtml(item) {
            const size = "20";
            if (item.hasMic) return `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>`;
            if (item.hasWebcam) return `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="10" r="8"></circle><circle cx="12" cy="10" r="3"></circle><path d="M7 22h10"></path><path d="M12 22v-4"></path></svg>`;
            if (item.hasAudio || item.isSpecial) return `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>`;
            if (item.hasSwipe) return `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0"></path><path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2"></path><path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8"></path><path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"></path></svg>`;
            if (item.hasEye) return `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>`;
            return '';
        }

        function handleItemClick(encodedItem) {
            const item = JSON.parse(decodeURIComponent(encodedItem));
            currentItem = item;
            document.getElementById('home-view').classList.add('fade-out-scale');
            setTimeout(() => {
                const dv = document.getElementById('detail-view');
                dv.classList.remove('hidden-down');
                dv.classList.add('fade-in-up');
                setupDetailView(item);
            }, 600);
        }

        function goBack() { window.location.reload(); }

        function setupDetailView(item) {
            const iframe = document.getElementById('external-iframe');
            const overlay = document.getElementById('av-overlay');
            const startBtn = document.getElementById('start-btn');
            const startText = document.getElementById('start-btn-text');
            const startSubtext = document.getElementById('start-btn-subtext');
            const avSlogan = document.getElementById('av-slogan');
            
            iframe.classList.add('hidden');
            overlay.classList.add('hidden');
            document.getElementById('hydra-canvas').classList.add('hidden');
            document.getElementById('standard-content').classList.add('hidden');
            iframe.src = "";
            startSubtext.innerText = ""; 
            avSlogan.classList.add('hidden'); 

            if (item.isSpecial) {
                overlay.classList.remove('hidden');
                startText.innerText = "Dopo aver cliccato, riclicca";
                avSlogan.classList.remove('hidden');
                startBtn.onclick = () => { overlay.classList.add('hidden'); iframe.src = item.link; iframe.classList.remove('hidden'); };
                return;
            }

            if (item.link) {
                iframe.src = item.link;
                iframe.classList.remove('hidden');
            } else {
                document.getElementById('standard-content').classList.remove('hidden');
            }
        }

        function toggleHelp() {
            const modal = document.getElementById('help-modal');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => modal.classList.remove('opacity-0'), 10);
            } else {
                modal.classList.add('opacity-0');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
        }

        function handleExit() {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (AudioContext) {
                if (!audioCtx) audioCtx = new AudioContext();
                if (audioCtx.state === 'suspended') audioCtx.resume();
                const bufferSize = audioCtx.sampleRate * 3; 
                const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
                const noise = audioCtx.createBufferSource();
                noise.buffer = buffer;
                const gain = audioCtx.createGain();
                gain.gain.value = 0.4;
                noise.connect(gain);
                gain.connect(audioCtx.destination);
                noise.start();
            }
            document.getElementById('home-view').classList.add('opacity-0');
            setTimeout(() => {
                const exitView = document.getElementById('exit-view');
                exitView.classList.remove('hidden');
                setTimeout(() => {
                    exitView.classList.add('hidden');
                    document.getElementById('home-view').classList.remove('opacity-0');
                }, 3000);
            }, 300);
        }

        function startTitleGlitch() {
            const titleEl = document.getElementById('synthesis-title');
            const fonts = ['"Monoton"', '"Press Start 2P"', '"Permanent Marker"', '"Orbitron"', '"Pixelify Sans"', '"Righteous"'];
            const defaultFont = '"Inter", sans-serif';
            setInterval(() => {
                let glitchCount = 0;
                const glitchInterval = setInterval(() => {
                    titleEl.style.fontFamily = fonts[Math.floor(Math.random() * fonts.length)];
                    glitchCount++;
                    if (glitchCount >= 8) { clearInterval(glitchInterval); titleEl.style.fontFamily = defaultFont; }
                }, 250); 
            }, 5000); 
        }
    </script>
</body>
</html>
